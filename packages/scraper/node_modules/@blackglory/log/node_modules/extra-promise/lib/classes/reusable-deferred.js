import { Deferred } from "./deferred.js";
import { pass } from '@blackglory/pass';
export class ReusableDeferred {
    constructor() {
        this.deferred = this.createDeferred();
    }
    get then() {
        return this.deferred.then.bind(this.deferred);
    }
    resolve(value) {
        // resolve掉上一个Deferred后就立即用新的Deferred覆盖, 下一个ReusableDeferred调用者会阻塞.
        this.deferred.resolve(value);
        this.deferred = this.createDeferred();
    }
    reject(reason) {
        // reject掉上一个Deferred后就立即用新的Deferred覆盖, 下一个ReusableDeferred调用者会阻塞.
        this.deferred.reject(reason);
        this.deferred = this.createDeferred();
    }
    createDeferred() {
        const deferred = new Deferred();
        Promise.resolve(deferred).catch(pass);
        return deferred;
    }
}
//# sourceMappingURL=reusable-deferred.js.map