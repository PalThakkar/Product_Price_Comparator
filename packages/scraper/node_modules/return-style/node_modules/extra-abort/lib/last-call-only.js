import { pass } from '@blackglory/pass';
import { go } from '@blackglory/go';
import { LinkedAbortController } from './linked-abort-controller.js';
import { AbortController } from './abort-controller.js';
export function lastCallOnly(fn) {
    let lastController;
    let lastPromise;
    return (...args) => {
        const realArgs = args.slice(0, -1);
        const signal = args[args.length - 1];
        lastController === null || lastController === void 0 ? void 0 : lastController.abort();
        const controller = signal
            ? new LinkedAbortController(signal)
            : new AbortController();
        lastController = controller;
        const promise = go(async () => {
            try {
                await lastPromise;
            }
            catch (_a) {
                pass();
            }
            if (controller.signal.aborted)
                throw controller.signal.reason;
            return await fn(...realArgs, controller.signal);
        });
        lastPromise = promise;
        return promise;
    };
}
//# sourceMappingURL=last-call-only.js.map