import { lazy } from '@blackglory/prelude';
export class ReusableAsyncIterable {
    constructor(iterable) {
        this.getIterator = lazy(() => iterable[Symbol.asyncIterator]());
    }
    get done() {
        return this._done;
    }
    async close() {
        var _a, _b;
        if (!this.done) {
            this._done = true;
            await ((_b = (_a = this.getIterator()).return) === null || _b === void 0 ? void 0 : _b.call(_a));
        }
    }
    [Symbol.asyncIterator]() {
        return {
            next: async () => {
                if (this._done)
                    return { done: true, value: undefined };
                const { value, done } = await this.getIterator().next();
                if (done) {
                    this._done = true;
                }
                return { value, done };
            }
        };
    }
}
//# sourceMappingURL=reusable-async-iterable.js.map